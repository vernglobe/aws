"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("aws-sdk"),e=require("https"),r=require("assert");function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var o=n(t),a=n(e),i=n(r),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u={};!function(t){var e;Object.defineProperty(t,"__esModule",{value:!0}),function(t){t[t.Debug=20]="Debug",t[t.Info=30]="Info",t[t.Warn=40]="Warn",t[t.Error=50]="Error"}(e||(e={}));const r=(t,r)=>{t.level=r;const n=JSON.stringify(t);switch(r){case e.Error:console.error(n);break;case e.Warn:console.warn(n);break;case e.Info:console.log(n);break;case e.Debug:console.debug(n);break;default:console.log(n)}},n=t=>"object"==typeof t?t:{message:t};t.default=class{constructor(t){this.name=t}debug(t){r(n({message:t,name:this.name}),e.Debug)}info(t){r(n({message:t,name:this.name}),e.Info)}warn(t){r(n({message:t,name:this.name}),e.Warn)}error(t){const o=n(t);t.error&&(o.error=t.error.stack),o.reason=t.reason,r(o,e.Error)}}}(u);var f=c(u),l="[object GeneratorFunction]",p=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,h=/^\w*$/,_=/^\./,d=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,y=/\\(\\)?/g,v=/^\[object .+?Constructor\]$/,g="object"==typeof s&&s&&s.Object===Object&&s,b="object"==typeof self&&self&&self.Object===Object&&self,m=g||b||Function("return this")();var w,j=Array.prototype,O=Function.prototype,S=Object.prototype,$=m["__core-js_shared__"],E=(w=/[^.]+$/.exec($&&$.keys&&$.keys.IE_PROTO||""))?"Symbol(src)_1."+w:"",A=O.toString,k=S.hasOwnProperty,M=S.toString,W=RegExp("^"+A.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I=m.Symbol,D=j.splice,P=U(m,"Map"),x=U(Object,"create"),F=I?I.prototype:void 0,C=F?F.toString:void 0;function N(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function T(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function q(t){var e=-1,r=t?t.length:0;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function J(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}function R(t,e){var r;e=function(t,e){if(L(t))return!1;var r=typeof t;if("number"==r||"symbol"==r||"boolean"==r||null==t||V(t))return!0;return h.test(t)||!p.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:L(r=e)?r:H(r);for(var n=0,o=e.length;null!=t&&n<o;)t=t[z(e[n++])];return n&&n==o?t:void 0}function G(t){if(!Q(t)||(e=t,E&&E in e))return!1;var e,r=function(t){var e=Q(t)?M.call(t):"";return"[object Function]"==e||e==l}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?W:v;return r.test(function(t){if(null!=t){try{return A.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}function K(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function U(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return G(r)?r:void 0}N.prototype.clear=function(){this.__data__=x?x(null):{}},N.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},N.prototype.get=function(t){var e=this.__data__;if(x){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return k.call(e,t)?e[t]:void 0},N.prototype.has=function(t){var e=this.__data__;return x?void 0!==e[t]:k.call(e,t)},N.prototype.set=function(t,e){return this.__data__[t]=x&&void 0===e?"__lodash_hash_undefined__":e,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(t){var e=this.__data__,r=J(e,t);return!(r<0)&&(r==e.length-1?e.pop():D.call(e,r,1),!0)},T.prototype.get=function(t){var e=this.__data__,r=J(e,t);return r<0?void 0:e[r][1]},T.prototype.has=function(t){return J(this.__data__,t)>-1},T.prototype.set=function(t,e){var r=this.__data__,n=J(r,t);return n<0?r.push([t,e]):r[n][1]=e,this},q.prototype.clear=function(){this.__data__={hash:new N,map:new(P||T),string:new N}},q.prototype.delete=function(t){return K(this,t).delete(t)},q.prototype.get=function(t){return K(this,t).get(t)},q.prototype.has=function(t){return K(this,t).has(t)},q.prototype.set=function(t,e){return K(this,t).set(t,e),this};var H=B((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(V(t))return C?C.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var r=[];return _.test(t)&&r.push(""),t.replace(d,(function(t,e,n,o){r.push(n?o.replace(y,"$1"):e||t)})),r}));function z(t){if("string"==typeof t||V(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e}function B(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],a=r.cache;if(a.has(o))return a.get(o);var i=t.apply(this,n);return r.cache=a.set(o,i),i};return r.cache=new(B.Cache||q),r}B.Cache=q;var L=Array.isArray;function Q(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function V(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==M.call(t)}var X=function(t,e,r){var n=null==t?void 0:R(t,e);return void 0===n?r:n};const{AWS_REGION:Y,AWS_CHAOS:Z}=process.env,tt=o.default,et=new a.default.Agent({keepAlive:!0}),rt=new f("vernglobe-aws");tt.config.update({region:Y,httpOptions:{agent:et}}),tt.config.logger={log:(...t)=>{const e={...t};rt.debug(e)}};const nt=new Map,ot={};"string"==typeof Z&&Z.split(",").forEach((t=>{const[e,r,n,o]=t.split("|");ot[e]={code:r,message:n,percentage:parseFloat(o)}}),{});exports.default=function(t,e,r,n){const o=X(tt,t);let a;i.default(void 0!==o,`Unable to resolve ${t} via AWS SDK`),nt.has(t)?a=nt.get(t):(a=new o(n),nt.set(t,a));const s=`${t}.${e}`,c=a[e];if(i.default(void 0!==c,`Unable to resolve ${s} via AWS SDK`),ot[s]){const{percentage:t,code:e,message:r}=ot[s];if(t>(u=0,f=100,u=Math.ceil(u),f=Math.floor(f),Math.floor(Math.random()*(f-u+1))+u)){const t={code:e,message:r};throw Error(JSON.stringify(t))}}var u,f;return a[e](r).promise().catch((o=>{throw rt.error(o),o.message+=` arguments: ${JSON.stringify({service:t,options:n,method:e,parameters:r})}`,o}))};
